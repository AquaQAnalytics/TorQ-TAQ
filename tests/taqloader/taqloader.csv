action,ms,bytes,lang,code,repeat,minver,comment
before,0,,q,"hdbdir:hsym`$getenv[`KDBHDB]",1,0,set hdb env
before,0,,q,"symdir:hsym`$getenv[`KDBHDB]",1,0,set sym env
before,0,,q,"tempdb:hsym`$getenv[`TORQTAQTEMPDB]",1,0,set tempdb env
before,0,,q,"filedrop:hsym`$getenv[`KDBTESTS],"/taqfiles/"",1,0,set tempdb env
before,0,,q,"filetypeq:`quote",1,0,define quote filetype
before,0,,q,"filetypet:`trade",1,0,define trade filetype
before,0,,q,"filetypen:`nbbo",1,0,define nbbo filetype
before,0,,q,"optionalparams:()!()",1,0,define optionalparams
before,0,,q,"filetoloadq1:`SPLITS_US_ALL_BBO_A_20180103.gz",1,0,define filetoload for quote
before,0,,q,"filepathq1:hsym`$getenv[`KDBTESTS],"/taqfiles/SPLITS_US_ALL_BBO_A_20180103.gz"",1,0,define correct filepath
before,0,,q,"loadidq1:1",1,0,define loadid
before,0,,q,"filetoloadq2:`SPLITS_US_ALL_BBO_X_20180103.gz",1,0,define filetoload for quote that does not exist
before,0,,q,"filepathq2:hsym`$getenv[`KDBTESTS],"/taqfiles/SPLITS_US_ALL_BBO_X_20180103.gz"",1,0,define filepath for quote that does not exist
before,0,,q,"loadidq2:2",1,0,define loadid
before,0,,q,"filetoloadq3:`SPLITS_US_ALL_BBO_A_2018010A.gz",1,0,define filetoload for quote with an incorrect date
before,0,,q,"filepathq3:hsym`$getenv[`KDBTESTS],"/taqfiles/SPLITS_US_ALL_BBO_A_2018010A.gz"",1,0,define filepath for quote with an incorrect date
before,0,,q,"loadidq3:3",1,0,define loadid
before,0,,q,"filetoloadq4:`EQY_US_ALL_TRADE_20180305.gz",1,0,define filetoload for quote with an incorrect date
before,0,,q,"filepathq4:hsym`$getenv[`KDBTESTS],"/taqfiles/EQY_US_ALL_TRADE_20180305.gz"",1,0,define filepath for quote with an incorrect date
before,0,,q,"loadidq4:4",1,0,define loadid
before,0,,q,"filetoloadq5:`EQY_US_ALL_NBBO_20180306.gz",1,0,define filetoload for quote with an incorrect date
before,0,,q,"filepathq5:hsym`$getenv[`KDBTESTS],"/taqfiles/EQY_US_ALL_NBBO_20180306.gz"",1,0,define filepath for quote with an incorrect date
before,0,,q,"loadidq5:5",1,0,define loadid
before,0,,q,"quoteparA:`$"quoteA/2018.01.03/quote"",1,0,define c as quote partition
before,0,,q,"tradepar:`$"final/2018.03.05/trade"",1,0,define trade partition
before,0,,q,"nbbopar:`$"final/2018.03.06/nbbo"",1,0,define nbbo partition
before,0,,q,"taqloaderparamsq1:`filetype`filetoload`filepath`loadid!(filetypeq;filetoloadq1;filepathq1;loadidq1)",1,0,define taqloaderparams
before,0,,q,"a:"Could not find: "",1,0,define a
before,0,,q,"b:a,.os.pth filepathq2",1,0,define b to complete path
before,0,,q,"d:"Could not extract date in "",1,0,define d to complete path
before,0,,q,"taqloaderparamsq2:`filetype`filetoload`filepath`loadid!(filetypeq;filetoloadq2;filepathq2;loadidq2)",1,0,define taqloaderparams
run,0,,q,"result1:loadtaqfile[taqloaderparamsq1;optionalparams]",0,0, run loader function for correct file
run,0,,q,"result2:loadtaqfile[taqloaderparamsq2;optionalparams]",0,0, run loader function for correct file
true,0,,q,"(result1 _ `loadendtime)~`tablepath`tabletype`loadid`tabledate`loadstatus`loadmessage!(.Q.dd[tempdb;quoteparA];`quote;1;2018.01.03;1h;"success")",0,0,compare all results except loadendtimehdbdi
true,0,,q,"(result2 _ `loadendtime)~`tablepath`tabletype`loadid`tabledate`loadstatus`loadmessage!(`;`quote;2;2018.01.03;0h;b)",0,0,compare all results except loadendtime
true,0,,q,"(result3 _ `loadendtime)~`tablepath`tabletype`loadid`tabledate`loadstatus`loadmessage!(`;`quote;3;0Nd;0h;d,string filetoloadq3)",0,0,compare all results except loadendtime
true,0,,q,"(result4 _ `loadendtime)~`tablepath`tabletype`loadid`tabledate`loadstatus`loadmessage!(.Q.dd[tempdb;tradepar];`trade;4;2018.03.05;1h;"")",0,0,compare results for trade file
true,0,,q,"(result5 _ `loadendtime)~`tablepath`tabletype`loadid`tabledate`loadstatus`loadmessage!(.Q.dd[tempdb;nbbopar];`nbbo;5;2018.03.06;1h;"")",0,0,compare results for nbbo file